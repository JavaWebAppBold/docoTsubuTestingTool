

# docoTsubu動作テストツール

本ツールは、docoTsubuの動作確認の作業を自動で実施するツールです。


## 前提

本ツールは以下を前提として動作します

* docoTsubuが既に起動済みである
    * Eclipseで ``` docoTsubu.war ``` を読み込んで起動しておく
	* または、tomcatを起動して ``` webapp ``` ディレクトリ配下に ``` docoTsubu.war ``` を配置する。
    * Portはデフォルト（8080）であること。

## 制限

本ツールには以下の制限があります。

* 動作テスト時の「成功」「失敗」の判定基準は、以下です。
    * 画面遷移系：遷移先の画面に想定するPathが存在する場合に正常とする
	    * 例）ログインの検証ではMain.jspに ``` href="/docoTsubu/Main" ``` が記載されていること
		* このため、docoTsubuをカスタムする際にpathを変更されると正しい結果を判定できません
	* 機能系：機能実施後に期待した状態となっているか
	    * 例）「投稿内容がDBで管理されている」検証では、実際にDBの中に投稿した内容が入っているか検証します。
* ~~2025/02現在、本ツールを実施する度に動作テストで使用した投稿内容がH2DB内に残り続けます。~~
    * ~~（少量とはいえ）ストレージを圧迫します。手動でテーブルのクリアをお願いします。~~
	* 2025/06提供のJarで解消済み

## 本ツールの使い方

本ツールには以下２つの使い方があります。

* Javaコマンドで実行
* Eclipseで実行

それぞれの使い方を以下で詳解します。

### Javaコマンドで実行

お好きなターミナルから、``` testapp.jar ``` のあるディレクトリに移動します。

以下のJavaコマンドで実行できます。

```
$ java -jar testapp.jar
```

### Eclipseで実行

Eclipseで実行する場合、大きく3つのステップからなります。

その内、初回に実行するのは以下の2つです。

* [1. プロジェクトをインポートする](#プロジェクトをインポートする)
* [2. JREのバージョンを最新にする](#JREのバージョンを最新にする)

テストごとに実施するのは以下です。

* [3. docoTsubu動作テスト実行する](#docoTsubu動作テスト実行する)

上述3ステップについて、詳細な手順をいかに示します。

#### 1. プロジェクトをインポートする{#プロジェクトをインポートする}
1. ``` Project Explorer ```で右クリックする。
2. コンテキストメニューから ``` Import ``` を選択する。
3. Importダイアログから ``` Java EE ``` の ``` App Client JAR file```を選択する。
4. 上述3. の選択後、Importダイアログ下の ``` Next ``` ボタンを押下する。
5. Importダイアログの ``` Application Client file ``` 横の ``` Browse... ```ボタンを押下する。
6. 開いたファイルチューザから、取得した ``` testapp.jar ``` を選択して、開くボタンを押下する。
7. Importダイアログに戻ったら、``` Application Client project ``` に任意の名前を入力する。
    * ここでは説明のため、``` testDocoTsubu ``` と入力したことにします。
8. Importダイアログ下の ``` Finish ``` ボタンを押下する。
9. ``` Project Explorer ```に上述7. で入力した名前のプロジェクトがあることを確認する。
    * ここでは ``` testDocoTsubu ``` プロジェクトがあることを確認する。

#### 2. JREのバージョンを最新にする{#JREのバージョンを最新にする}
1. testDocoTsubuプロジェクトで右クリックする。
2. コンテキストメニューから ``` Properties ``` を選択する。（一番下の項目）
3. ポップアップウィンドウの左側にあるツリーペインから ``` Java Build Path ``` を選択する。
    1. ウィンドウ右側のメインペインのヘッダーから ``` Libraries ``` を選択する。
	2. ``` Modulepath ``` > ``` JRE System Library ``` を選択する。
	3. 左側にある ``` Edit ``` を選択する。
	    1. ポップアップウィンドウの ``` System Library ``` > ``` Execution enviroment:  ``` から ``` JavaSE-15(jre) ``` を選択する。
	        * JREのバージョンは新しければ新しいほどいい。
        2. ``` Finish ``` ボタンを押下する。
	4. ``` Apply and Close ``` ボタンを押下する。

#### 3. docoTsubu動作テスト実行する{#docoTsubu動作テスト実行する}
1. testDocoTsubuプロジェクトで右クリックする。
2. コンテキストメニューから ``` Run As ``` を選択する。
3. ポップアップメニューから ``` Java Application ``` を選択する。
4. ポップアップした``` Select Java Application ``` ダイアログの ``` Matching items: ``` から ``` Main -jp.co.app ``` を選択する。
5. ``` Select Java Application ``` ダイアログ下の ``` OK ``` ボタンを押下する。
6. ``` Console ```パネル？ウィンドウ？に実行結果が出てくるので確認してください。

## 出力例

### OK時

![OK時](./assets/OK_output.png)

### NG時

![NG時](./assets/NG_output.png)

### 例外発生時

![RE時](./assets/RE_output.png)




## 今後の改修（TODO）

* ☑動作テストで投稿したつぶやきのみをDBから削除する（動作テスト実施前後でDBに差分がない）
* ☑結果がNGの時、期待値と実際値との差分を結果に表示する
* ☑本ツールでの動作テスト実施前に、docoTsubuが起動しているかチェックする
* ☑テスト結果にSHA256などのMessageDigestを組み込む（改竄防止施策）
* ~~□JSP化（JSP化の旨味がなくなりつつある気がする……）~~

## 修正履歴

* 2025/06/01 出力の仕様変更と不具合対応を行った
    * 出力の仕様変更：テストの期待値と実際値を出力するようにした
    * 不具合対応：画面上に表示されているつぶやきの判定ロジックを緩和した。
    * 不具合対応：WhitePageが表示された場合にNGと判定できるように修正した。






